老师、助教和同学们，大家好！我是胡博浩，今天我将为大家展示实验一的内容。

------------

这次展示主要分为三个部分：实验工具和环境、分析流程、以及Yara规则编写和分析。

------------

首先是实验中使用的工具和环境。  
在实验中，我使用了VirusTotal和Microsoft Defender AntiVirus两个平台。

------------

另外，我还使用了DIE、ExeinfoPE、StudyPE+、pestudio等工具，来查看文件的详细信息。

------------

针对加壳的文件，我使用了UPX工具和Xvolkolak进行脱壳分析，以便深入分析文件的内部结构。  
实验在Windows本机和虚拟机环境中进行。

------------

接下来是具体的分析流程。  
首先，我们使用 VirusTotal 和 Microsoft Defender AntiVirus 对恶意软件进行初步检测。VirusTotal 能够显示匹配的病毒特征码，报告病毒名称。而 Microsoft Defender 则提供自定义扫描功能，显示详细的威胁信息。

------------

我们先使用 VirusTotal 对样本进行扫描。以 Lab01-04.exe 为例，它的结果表明该程序与下载器相关。

------------

并且VirusTotal可以提供详细的反病毒引擎报告，包括识别出的恶意代码名称和其潜在的危害程度。这为我们进一步分析提供了重要线索。

------------

随后，我使用Microsoft Defender AntiVirus对文件进行了自定义扫描。

------------

扫描结果显示，Lab01-04.exe和其他几个文件包含多个威胁，每个样本对应一个。

------

查看。。。

其中Lab01-02.exe还显示了加壳信息，而Lab01-04.exe则具有下载其他程序的特性，进一步确认了它们的恶意行为。

------

第十二页
如图所示，显示为UPX。

------

第十三页
详细信息表明，Lab01-04.exe会下载其他程序。

------

第十四页

接着，可以查看文件的编译时间，通过。。。

编译时间可以帮助我们推测恶意代码的生成时间和潜在的作者背景。

------

第十五页
以Lab01-01为例，使用 DIE 工具查看文件的编译时间字段。

------

第十六页
这个文件为16:1。

------

第十七页
这个文件为16:3。

------

第十八页
可以看到它的两个文件编译时间非常接近，说明很可能是由同一作者在同一时间创建

因为DLL。。。

------

第十九页
文件加壳是恶意代码常用的伪装手段之一。

检查文件是否加壳可以使用

------

第二十页
另外，除了使用工具，也可以通过加壳文件的一些特征判断，比如文件的节没有名字或者名字特殊、节的虚拟大小和原始数据差别较大、导入表极小、导入函数只有少数几个等。这些特征有助于判断文件是否被加壳。

------

第二十一页
当我们确认文件被加壳后，接下来要做的就是脱壳分析。

------

第二十二页
。。。

------

第二十三页
如图所示，文件类型那里表明了壳的类型为FSGv1.00。

------

第二十四页：脱壳工具
。。。

------

第二十五页：脱壳成功
。。。

------

第二十六页
除了自动脱壳，我也尝试了手动脱壳。由于文件没有设置复杂的反调试机制，脱壳过程相对顺利，成功获取到了文件的完整内容。

------

第二十七页
。。。

这有助于识别文件中可能存在的可疑函数调用和恶意代码片段。

。。。

这种行为在恶意代码中很常见，攻击者往往通过这种方式进行隐蔽攻击。

------

第二十八页
。。。

------

第二十九页
如图所示，资源节符合上述两个特征

------

第三十页

接下来进入Yara规则的编写和分析部分。Yara是一种强大的恶意代码检测工具，通过定义规则可以快速扫描出恶意代码。

为了提高Yara规则的性能，我采取了三种优化方法：。。。

------

第三十一页
这个是我编写的所有样本通用的全局规则，

主要筛选条件是。。。

------

第三十二页
。。。

------

第三十三页
例如在Lab01-02.exe中，脱壳后发现它是一个可疑的网址，但脱壳前检测到的是一串十六进制码，就直接把这一串十六进制码作为筛选条件。

------

第三十四页
编写好Yara规则后，我将其保存为lab1.yar文件，并使用它对实验样本进行扫描，结果五个文件都被成功检出。

------

第三十五页
为了验证规则的执行效率，我编写了一个Python脚本，记录了扫描时间和结果，以评估Yara规则在实际应用中的性能表现。

------

第三十六页
实验结果显示，在扫描一个1GB大小、包含1162个文件的文件夹时，Yara仅用1.07秒就完成了检测，效率非常高。

并且仔细查看检查结果，可以发现只有恶意样本被检测出来、而其他正常文件则没有，说明yara规则准确率也不错

------

第三十七页
另外我也对如何优化yara规则性能做了探讨，总结了一些提升Yara执行效率的规律：

- 在特定地址范围内进行搜索比全局搜索效率更高。
- 另外，尽量避免使用通配符和复杂的正则表达式，因为这些匹配方式会明显降低Yara的执行速度。
- 在16进制匹配中，使用??比[...]的效率更高，这种优化措施能够在大文件扫描中体现出明显的性能提升。
- 在处理大文件时，我们还可以分批进行扫描，避免一次性处理大量数据，这样可以大幅提升扫描的整体效率。

------

第三十八页
我的展示到此结束。谢谢大家！
